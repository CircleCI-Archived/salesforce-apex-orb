# Create and open a scratch org.
description: >
  'Create and open a scratch org.'
parameters:
  scratch-config:
    description: 'The scratch JSON definition.'
    type: string
  scratch-alias:
    description: 'The alias of the scratch Org.'
    type: string
  overrides:
    description: 'Overrides for scratch organization.'
    type: string
    default: ''
  permset:
    description: 'Permissions set to assign to the user for the organization.'
    type: string
    default: ''
  sample-data:
    description: 'Path to sample data for the organization.'
    type: string
    default: ''

steps:
  - sfdx/scratch-create:
      scratch-config: <<parameters.scratch-config>>
      scratch-alias: <<parameters.scratch-alias>>
      overrides: <<parameters.overrides>>
  - sfdx/scratch-open:
      scratch-alias: <<parameters.scratch-alias>>
  - when:
      condition: << parameters.permset >>
      steps:
        - run:
            name: Assign << parameters.permset >> permset for organization
            command: sfdx force:user:permset:assign -n << parameters.permset >> -u <<parameters.scratch-alias>>
  - when:
      condition: << parameters.sample-data >>
      steps:
        - run:
            name: Import sample data plan from << parameters.sample-data >>
            command: sfdx force:data:tree:import --plan << parameters.sample-data >> -u <<parameters.scratch-alias>>
